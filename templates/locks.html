<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Locks</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding-top: 40px;
            padding-bottom: 40px;
            background-color: #f5f5f5;
        }
        .form-auth {
            max-width: 330px;
            padding: 15px;
            margin: 0 auto;
        }
    </style>
</head>
<body class="text-center">
<div class="container">

<div class="container mt-5">
    <div class="row">
        <div class="col-md-10 mx-auto">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h3>Мои замки TTLock</h3>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                            <tr>
                                <th>ID</th>
                                <th>Название</th>
                                <th>Псевдоним</th>
                                <th>Группа</th>
                                <th>Батарея</th>
                                <th>Действия</th>
                            </tr>
                            </thead>
                            <tbody>
                            {{range .Locks}}
                            <tr>
                                <td>{{.ID}}</td>
                                <td>{{.Name}}</td>
                                <td>{{.Alias}}</td>
                                <td>{{.GroupName}}</td>
                                <td>
                                    <div class="progress">
                                        <div class="progress-bar {{if lt .Battery 20}}bg-danger{{else if lt .Battery 50}}bg-warning{{else}}bg-success{{end}}"
                                             role="progressbar" style="width: 50px"
                                             aria-valuenow="{{.Battery}}" aria-valuemin="0" aria-valuemax="100">
                                            {{.Battery}}%
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <button class="btn btn-sm btn-primary unlock-btn"
                                            data-id="{{.ID}}">Открыть</button>
                                    <button class="btn btn-sm btn-secondary lock-btn"
                                            data-id="{{.ID}}">Закрыть</button>
                                </td>
                            </tr>
                            {{else}}
                            <tr>
                                <td colspan="6" class="text-center">Нет доступных замков</td>
                            </tr>
                            {{end}}
                            </tbody>
                        </table>
                    </div>
                    <a href="/" class="btn btn-outline-primary mt-3">На главную</a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {
        // Обработчики кнопок открытия/закрытия
        $('.unlock-btn').click(function() {
            const lockId = $(this).data('id');
            controlLock(lockId, '1');
        });

        $('.lock-btn').click(function() {
            const lockId = $(this).data('id');
            controlLock(lockId, '2');
        });

        function controlLock(lockId, action) {
            $.post('/api/ttlock/control', {
                lockId: lockId,
                action: action
            }, function() {
                alert('Команда отправлена успешно');
            }).fail(function() {
                alert('Ошибка отправки команды');
            });
        }
    });
</script>

</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>